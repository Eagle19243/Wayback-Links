/*!
 * =============================================================
 * wayback-links v1.0.0 - Wayback Links
 * https://github.com/internetarchive/wayback-links#readme
 *
 * (c) 2017 - Eagle19243
 * =============================================================
 */

!function(t,e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):t.Wayback_links=e(t.jQuery)}(this,function(t){function e(t){return Boolean(t)&&(c.test(t)||!l.test(t))}function r(t,e,r){var n=document.createElement("li"),a=document.createElement("div"),i=document.createElement("a");i.setAttribute("class","waybackLinks WLItem"),i.href=r,i.innerHTML=e,a.appendChild(i),n.appendChild(a),t.appendChild(n)}function n(t){return t<10&&(t="0"+t),t}function a(t){var e=new Date(t);if(isNaN(e)&&(e=new Date(t.replace(/ /g,"T")),isNaN(e)))return"Invalid date";var r="";return r+=e.getUTCFullYear(),r+=n(e.getUTCMonth()+1),r+=n(e.getUTCDate()),r+=n(e.getUTCHours()),r+=n(e.getUTCMinutes()),r+=n(e.getUTCSeconds())}function i(t){var e=a(t),r=e.substr(0,4)+"-"+e.substr(4,2)+"-"+e.substr(6,2);return"000000"!=e.substr(8,6)&&(r+=" "+e.substr(8,2)+":"+e.substr(10,2)+":"+e.substr(12,2)),r}function o(t){var e=t.match(b);if(e&&e.length>1){var r=e[1];return r.length>15?r.substr(0,15)+"...":r}return"unknown archive"}function s(){h&&(h.setAttribute("aria-hidden","true"),h=null)}function u(t,e){try{return t.getAttribute(e).trim()}catch(t){return""}}var d=["https?://dx.doi.org*","https?://doi.org*"],c=/^https?:/,l=/:/,p=["https?://webarchive.nationalarchives.gov.uk/*","https?://web.archive.org/*"],m={"date-published":"Get near page creation date ","date-modified":"Get near page modified date "};Array.prototype.indexOf||(Array.prototype.indexOf=function(t){for(var e=this.length;e--;)if(this[e]===t)return e;return-1});var h,f=function(){return"WL_"+Math.random().toString(36).substr(2,9)},b=new RegExp("(?:https?://)?(?:www\\.)?((?:[A-Za-z0-9_\\.])+)(?:/.*)?","i");return document.addEventListener("DOMContentLoaded",function(){for(var t=document.getElementsByTagName("meta"),n={},c=0;c<t.length;c++){var l=u(t[c],"itemprop");if(l in m){var b=u(t[c],"content");n[l]={linkstr:"",printstr:""},n[l].linkstr=a(b),n[l].printstr=i(b)}}for(var v=document.getElementsByTagName("a"),c=0;c<v.length;c++){var g=u(v[c],"href");if(0==!g.search("http")){var k=window.location,w=k.protocol+"//"+k.host;0==!g.search("/|../|./")&&(w+="/"),g=w+g}var y=u(v[c],"data-original-url"),A=Boolean(y);A||(y=g);var E=u(v[c],"data-version-url"),L=Boolean(E);!L&&A&&(E=g);var C=u(v[c],"data-version-date"),T=Boolean(C),B=new RegExp("(?:"+d.concat(p).join(")|(?:")+")");if(v[c].href.length>0&&(" "+v[c].className+" ").indexOf(" waybackLinks ")<0&&(Object.keys(n).length>0||A||L||T)&&!B.test(g)&&e(g)){var W=f(),x=document.createElement("span");x.setAttribute("role","navigation"),x.setAttribute("aria-label","WLElement");var N=document.createElement("ul"),M=document.createElement("li");M.setAttribute("aria-label","WLOuter");var j=document.createElement("a");j.href="",j.setAttribute("aria-haspopup","true"),j.setAttribute("class","waybackLinks dropDownButton WLArrow"),j.setAttribute("aria-controls",W);var D=document.createElement("div");D.setAttribute("class","waybackLinks dropDownButton WLIcon");var O=document.createElement("ul");O.setAttribute("class","WLMenu"),O.id=W,O.setAttribute("aria-hidden","true");var U=document.createElement("li");U.setAttribute("class","WLTitle"),U.innerHTML="Wayback Links",O.appendChild(U);for(l in n){var G="https://timetravel.mementoweb.org/memento/"+n[l].linkstr+"/"+y;r(O,m[l]+n[l].printstr,G)}if(T){var I=a(C),G="https://timetravel.mementoweb.org/memento/"+I+"/"+y;r(O,"Get near link date "+i(C),G)}(L||A)&&r(O,"Get from "+o(E),E),A&&r(O,"Get at current date",y),M.appendChild(j),M.appendChild(O),N.appendChild(M),x.appendChild(N),j.parentNode.insertBefore(D,j),j.onclick=function(t){var e=document.getElementById(this.getAttribute("aria-controls")),r="true"==e.getAttribute("aria-hidden");return s(),r?(e.setAttribute("aria-hidden","false"),h=e):(e.setAttribute("aria-hidden","true"),h=null),t.stopPropagation(),!1},v[c].parentNode.insertBefore(x,v[c].nextSibling)}}document.onclick=s},!1),Wayback_links});